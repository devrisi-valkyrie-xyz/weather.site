<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 100px;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.4);
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .subtitle {
            color: #666;
            font-size: 1.2em;
        }

        .search-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        input {
            flex: 1;
            padding: 18px 25px;
            border-radius: 15px;
            border: 3px solid #667eea;
            font-size: 18px;
            transition: all 0.3s;
            background: white;
        }

        input:focus {
            outline: none;
            border-color: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        button {
            padding: 18px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(-1px);
        }

        .quick-cities {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-city {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .quick-city:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .loading {
            text-align: center;
            display: none;
            margin: 30px 0;
            font-size: 1.5em;
            color: #667eea;
        }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            display: none;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.2em;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .weather-info {
            display: none;
        }

        .main-weather {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #CCA7A8;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .location {
            font-size: 2.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .coords {
            font-size: 0.4em;
            opacity: 0.8;
        }

        .weather-icon {
            font-size: 8em;
            margin: 20px 0;
            animation: bounce 3s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .temperature {
            font-size: 5em;
            font-weight: bold;
            margin: 20px 0;
        }

        .description {
            font-size: 1.8em;
            margin-bottom: 10px;
            text-transform: capitalize;
        }

        .timestamp {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-unit {
            font-size: 0.5em;
            color: #888;
        }

        .forecast-section {
            margin-top: 30px;
        }

        .section-title {
            font-size: 2em;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hourly-forecast {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .hourly-card {
            min-width: 120px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
        }

        .hourly-card:hover {
            transform: scale(1.05);
        }

        .hourly-time {
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .hourly-icon {
            font-size: 2.5em;
            margin: 10px 0;
        }

        .hourly-temp {
            font-size: 1.5em;
            font-weight: bold;
        }

        .daily-forecast {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .daily-card {
            background: white;
            border: 3px solid #667eea;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .daily-card:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }

        .daily-day {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .daily-icon {
            font-size: 3em;
            margin: 10px 0;
        }

        .daily-temps {
            font-size: 1.3em;
            margin-top: 10px;
        }

        .temp-high {
            color: #ff6b6b;
            font-weight: bold;
        }

        .temp-low {
            color: #4dabf7;
        }

        .additional-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-panel {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .info-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .info-content {
            font-size: 1.1em;
            line-height: 1.8;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* ===== NEW SVG TEMPERATURE CHART STYLES ===== */
        .temp-chart-wrapper {
            position: relative;
            width: 100%;
            margin-top: 15px;
            overflow: hidden;
        }

        .temp-svg-chart {
            width: 100%;
            height: 220px;
            overflow: visible;
        }

        .chart-tooltip {
            position: absolute;
            background: rgba(40, 20, 80, 0.92);
            color: white;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            white-space: nowrap;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .chart-tooltip::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(40, 20, 80, 0.92);
            border-bottom: none;
        }

        /* ===== END NEW STYLES ===== */

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.8em;
            margin: 5px;
        }

        .clothing-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #667eea;
            transition: all 0.3s;
        }

        .clothing-item:hover {
            transform: scale(1.05);
            background: #667eea;
            color: white;
        }

        .activity-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2em;
            }
            .temperature {
                font-size: 3em;
            }
        }
    </style>
</head>

<body>
<div class="animated-bg" id="animatedBg"></div>

<div class="container">
    <div class="header">
        <!-- <h1>üåû</h1> -->
        <h1>Ultimate Weather Dashboard</h1>
        <p class="subtitle">Real-time Weather Intelligence & Complete Lifestyle Forecasting System</p>
        <div>
            <span class="badge">Live Data</span>
            <span class="badge">7-Day Forecast</span>
            <span class="badge">India Tourism</span>
            <span class="badge">Activity Planner</span>
            <span class="badge">Air Quality</span>
            <span class="badge">Astronomy</span>
        </div>
    </div>

    <div class="search-section">
        <div class="search-box">
            <input id="cityInput" placeholder="üîç Enter city name (e.g., London, Delhi, Tokyo, New York)" 
                   onkeypress="if(event.key==='Enter') getWeather()">
            <button onclick="getWeather()">üåç Get Weather</button>
        </div>
        <div class="quick-cities">
            <span class="quick-city" onclick="quickSearch('London')">üá¨üáß London</span>
            <span class="quick-city" onclick="quickSearch('Delhi')">üáÆüá≥ Delhi</span>
            <span class="quick-city" onclick="quickSearch('Mumbai')">üáÆüá≥ Mumbai</span>
            <span class="quick-city" onclick="quickSearch('New York')">üá∫üá∏ New York</span>
            <span class="quick-city" onclick="quickSearch('Tokyo')">üáØüáµ Tokyo</span>
            <span class="quick-city" onclick="quickSearch('Paris')">üá´üá∑ Paris</span>
            <span class="quick-city" onclick="quickSearch('Dubai')">üá¶üá™ Dubai</span>
            <span class="quick-city" onclick="quickSearch('Sydney')">üá¶üá∫ Sydney</span>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>üîç Fetching comprehensive weather data & lifestyle information...</p>
    </div>

    <div class="error" id="error"></div>

    <div class="weather-info" id="weather">
        <div class="main-weather">
            <div class="location">
                <span id="location"></span>
                <div class="coords" id="coords"></div>
            </div>
            <div class="weather-icon" id="icon"></div>
            <div class="temperature" id="temp"></div>
            <div class="description" id="desc"></div>
            <div class="timestamp" id="timestamp"></div>
        </div>

        <div class="chart-container">
            <h3 class="section-title">üèõÔ∏è Today's Must-Visit Place in India</h3>
            <div id="mustVisitPlace" style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center;">
                <div style="font-size: 5em; text-align: center;" id="placeIcon"></div>
                <div>
                    <h3 style="color: #667eea; font-size: 1.8em; margin-bottom: 10px;" id="placeName"></h3>
                    <p style="font-size: 1.1em; color: #666; line-height: 1.6; margin-bottom: 10px;" id="placeDesc"></p>
                    <div style="margin-top: 10px;">
                        <span class="badge" id="placeState"></span>
                        <span class="badge" id="placeCategory"></span>
                        <span class="badge" id="placeBestTime"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üí®</div>
                <div class="stat-label">Wind Speed</div>
                <div class="stat-value"><span id="wind"></span> <span class="stat-unit">km/h</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üå°Ô∏è</div>
                <div class="stat-label">Feels Like</div>
                <div class="stat-value"><span id="feels"></span> <span class="stat-unit">¬∞C</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üß≠</div>
                <div class="stat-label">Wind Direction</div>
                <div class="stat-value"><span id="windDir"></span> <span class="stat-unit">¬∞</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üíß</div>
                <div class="stat-label">Humidity</div>
                <div class="stat-value"><span id="humidity"></span> <span class="stat-unit">%</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚òÅÔ∏è</div>
                <div class="stat-label">Cloud Cover</div>
                <div class="stat-value"><span id="cloudCover"></span> <span class="stat-unit">%</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåÖ</div>
                <div class="stat-label">UV Index</div>
                <div class="stat-value"><span id="uvIndex"></span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî≠</div>
                <div class="stat-label">Visibility</div>
                <div class="stat-value"><span id="visibility"></span> <span class="stat-unit">km</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéöÔ∏è</div>
                <div class="stat-label">Pressure</div>
                <div class="stat-value"><span id="pressure"></span> <span class="stat-unit">hPa</span></div>
            </div>
        </div>

        <div class="forecast-section">
            <h2 class="section-title">üìä 24-Hour Forecast</h2>
            <div class="hourly-forecast" id="hourlyForecast"></div>

            <h2 class="section-title">üìÖ 7-Day Forecast</h2>
            <div class="daily-forecast" id="dailyForecast"></div>
        </div>

        <div class="additional-info">
            <div class="info-panel">
                <div class="info-title">üå°Ô∏è Temperature Analysis</div>
                <div class="info-content">
                    <p>Current: <strong id="tempAnalysis"></strong></p>
                    <p>Daily High: <strong id="tempHigh"></strong></p>
                    <p>Daily Low: <strong id="tempLow"></strong></p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="tempProgress"></div>
                    </div>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">üíß Precipitation Data</div>
                <div class="info-content">
                    <p>Probability: <strong id="precipProb"></strong></p>
                    <p>Amount: <strong id="precipAmount"></strong></p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="precipProgress"></div>
                    </div>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">üåÖ Sun & Moon</div>
                <div class="info-content">
                    <p>‚òÄÔ∏è Sunrise: <strong id="sunrise"></strong></p>
                    <p>üåá Sunset: <strong id="sunset"></strong></p>
                    <p>‚è±Ô∏è Daylight: <strong id="daylight"></strong></p>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">üéØ Weather Insights</div>
                <div class="info-content" id="insights"></div>
            </div>
        </div>

        <div class="additional-info">
            <div class="info-panel">
                <div class="info-title">üåç Air Quality Index</div>
                <div class="info-content">
                    <p>AQI Level: <strong id="aqiLevel"></strong></p>
                    <p>Status: <strong id="aqiStatus"></strong></p>
                    <p>PM2.5: <strong id="pm25"></strong> Œºg/m¬≥</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="aqiProgress" style="background: linear-gradient(135deg, #51cf66 0%, #ffd43b 50%, #ff6b6b 100%);"></div>
                    </div>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">üåô Moon Phase</div>
                <div class="info-content">
                    <div style="text-align: center; font-size: 4em;" id="moonIcon"></div>
                    <p style="text-align: center;"><strong id="moonPhase"></strong></p>
                    <p style="text-align: center; font-size: 0.9em; color: #666;" id="moonIllumination"></p>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">‚≠ê Astronomical Info</div>
                <div class="info-content">
                    <p>üåå Solar Noon: <strong id="solarNoon"></strong></p>
                    <p>üåì Golden Hour: <strong id="goldenHour"></strong></p>
                    <p>‚ú® Star Visibility: <strong id="starVisibility"></strong></p>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">üéØ Seasonal Activities</div>
                <div class="info-content" id="seasonalActivities"></div>
            </div>
        </div>

        <div class="chart-container">
            <h3 class="section-title">üìö Random Weather Fact of the Day</h3>
            <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 15px; font-size: 1.1em; line-height: 1.8;" id="weatherFact"></div>
        </div>

        <div class="stats-grid" style="margin-top: 30px;">
            <div class="stat-card">
                <div class="stat-icon">üåä</div>
                <div class="stat-label">Dew Point</div>
                <div class="stat-value"><span id="dewPoint"></span> <span class="stat-unit">¬∞C</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚òÇÔ∏è</div>
                <div class="stat-label">Precipitation</div>
                <div class="stat-value"><span id="precipitation"></span> <span class="stat-unit">mm</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üå¨Ô∏è</div>
                <div class="stat-label">Wind Gust</div>
                <div class="stat-value"><span id="windGust"></span> <span class="stat-unit">km/h</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üé≠</div>
                <div class="stat-label">Weather Mood</div>
                <div class="stat-value" style="font-size: 1.5em;" id="weatherMood"></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üèÉ</div>
                <div class="stat-label">Outdoor Index</div>
                <div class="stat-value"><span id="outdoorIndex"></span> <span class="stat-unit">/10</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üå°Ô∏è</div>
                <div class="stat-label">Heat Index</div>
                <div class="stat-value"><span id="heatIndex"></span> <span class="stat-unit">¬∞C</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ùÑÔ∏è</div>
                <div class="stat-label">Wind Chill</div>
                <div class="stat-value"><span id="windChill"></span> <span class="stat-unit">¬∞C</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåà</div>
                <div class="stat-label">Rainbow Chance</div>
                <div class="stat-value"><span id="rainbowChance"></span> <span class="stat-unit">%</span></div>
            </div>
        </div>

        <div class="chart-container">
            <h3 class="section-title">üëî What to Wear Today</h3>
            <div id="clothingAdvice" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;"></div>
        </div>

        <div class="chart-container">
            <h3 class="section-title">üé® Weather-Based Activity Suggestions</h3>
            <div id="activitySuggestions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;"></div>
        </div>

        <div class="additional-info">
            <div class="info-panel">
                <div class="info-title">üåç Climate Zone</div>
                <div class="info-content">
                    <p>Type: <strong id="climateZone"></strong></p>
                    <p>Season: <strong id="currentSeason"></strong></p>
                    <p>Typical Range: <strong id="typicalRange"></strong></p>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-title">‚ö° Weather Alerts</div>
                <div class="info-content" id="weatherAlerts"></div>
            </div>

            <div class="info-panel">
                <div class="info-title">üì∏ Photography Tips</div>
                <div class="info-content" id="photoTips"></div>
            </div>

            <div class="info-panel">
                <div class="info-title">üå± Gardening Index</div>
                <div class="info-content">
                    <p>Planting: <strong id="plantingIndex"></strong></p>
                    <p>Watering: <strong id="wateringIndex"></strong></p>
                    <p>Activity: <strong id="gardeningActivity"></strong></p>
                </div>
            </div>
        </div>

        <!-- UPDATED TEMPERATURE TREND SECTION -->
        <div class="chart-container">
            <h3 class="section-title">üìà Temperature Trend (24h)</h3>
            <div class="temp-chart-wrapper">
                <svg class="temp-svg-chart" id="tempSvgChart" viewBox="0 0 900 220" preserveAspectRatio="none"></svg>
                <div class="chart-tooltip" id="chartTooltip"></div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>‚ö° Powered by Open-Meteo API | Real-time Weather Data</p>
        <p>üåç Global Coverage | üîÑ Auto-refresh Available | üì± Mobile Optimized</p>
        <p style="margin-top: 10px; font-size: 0.8em; opacity: 0.7;">üéØ Featuring Daily India Tourism Highlights | üåü Complete Weather Intelligence Suite | üé® Activity Planning | üëî Clothing Advice</p>
    </div>
</div>

<script>
function createClouds() {
    const bg = document.getElementById('animatedBg');
    for (let i = 0; i < 10; i++) {
        const cloud = document.createElement('div');
        cloud.className = 'cloud';
        cloud.style.width = Math.random() * 100 + 50 + 'px';
        cloud.style.height = Math.random() * 50 + 25 + 'px';
        cloud.style.top = Math.random() * 100 + '%';
        cloud.style.animationDelay = Math.random() * 20 + 's';
        cloud.style.animationDuration = (Math.random() * 20 + 15) + 's';
        bg.appendChild(cloud);
    }
}
createClouds();

function clothingItem(icon, label, query) {
    return `<div class="clothing-item" data-link="https://buyhatke.com/search?query=${encodeURIComponent(query)}">${icon}<br>${label}</div>`;
}

const indianPlaces = [
    { name: "Taj Mahal", state: "Uttar Pradesh", icon: "üïå", desc: "An iconic white marble mausoleum built by Emperor Shah Jahan in memory of his wife Mumtaz Mahal. A UNESCO World Heritage Site and symbol of eternal love.", category: "Historical", bestTime: "Oct-Mar" },
    { name: "Jaipur City Palace", state: "Rajasthan", icon: "üè∞", desc: "A stunning blend of Rajasthani and Mughal architecture with beautiful courtyards, gardens and museums showcasing royal artifacts.", category: "Palace", bestTime: "Nov-Feb" },
    { name: "Kerala Backwaters", state: "Kerala", icon: "üö§", desc: "A network of tranquil lagoons, lakes and canals lined with palm trees. Experience traditional houseboat cruises through serene waters.", category: "Nature", bestTime: "Sep-Mar" },
    { name: "Goa Beaches", state: "Goa", icon: "üèñÔ∏è", desc: "Golden sandy beaches with crystal clear waters, vibrant nightlife, Portuguese heritage and delicious seafood cuisine.", category: "Beach", bestTime: "Nov-Feb" },
    { name: "Varanasi Ghats", state: "Uttar Pradesh", icon: "üõï", desc: "Ancient spiritual city on the Ganges river with mystical ghats, evening aarti ceremonies and deeply spiritual atmosphere.", category: "Religious", bestTime: "Oct-Mar" },
    { name: "Mysore Palace", state: "Karnataka", icon: "üèõÔ∏è", desc: "A magnificent Indo-Saracenic palace with intricate carvings, painted ceilings and illuminated by 100,000 lights on Sundays.", category: "Palace", bestTime: "Oct-Feb" },
    { name: "Darjeeling Tea Gardens", state: "West Bengal", icon: "üçµ", desc: "Lush green tea plantations in the Himalayan foothills with stunning mountain views and the famous Darjeeling Himalayan Railway.", category: "Nature", bestTime: "Mar-May" },
    { name: "Hampi Ruins", state: "Karnataka", icon: "üóø", desc: "Ancient capital of Vijayanagara Empire with surreal boulder landscapes, magnificent temples and fascinating historical ruins.", category: "Historical", bestTime: "Oct-Feb" },
    { name: "Leh-Ladakh", state: "Jammu & Kashmir", icon: "üèîÔ∏è", desc: "High altitude desert with breathtaking mountain scenery, ancient monasteries and adventure activities at the roof of the world.", category: "Adventure", bestTime: "May-Sep" },
    { name: "Khajuraho Temples", state: "Madhya Pradesh", icon: "‚õ©Ô∏è", desc: "UNESCO World Heritage Site famous for intricate stone carvings and sculptures depicting various aspects of life and spirituality.", category: "Historical", bestTime: "Oct-Mar" },
    { name: "Andaman Islands", state: "Andaman & Nicobar", icon: "üèùÔ∏è", desc: "Pristine tropical paradise with turquoise waters, white sandy beaches, coral reefs and diverse marine life perfect for diving.", category: "Beach", bestTime: "Nov-Apr" },
    { name: "Ajanta Caves", state: "Maharashtra", icon: "üï≥Ô∏è", desc: "Ancient Buddhist rock-cut caves with stunning paintings and sculptures dating back to 2nd century BCE. UNESCO World Heritage Site.", category: "Historical", bestTime: "Nov-Mar" }
];

const weatherFacts = [
    "The highest temperature ever recorded on Earth was 134¬∞F (56.7¬∞C) in Death Valley, California on July 10, 1913! ‚òÄÔ∏è",
    "Lightning strikes the Earth about 100 times every second, which is about 8.6 million times per day! ‚ö°",
    "Raindrops can fall at speeds of up to 22 miles per hour (35 km/h) depending on their size! üíß",
    "A single cloud can weigh more than 1 million pounds! That's about the weight of 100 elephants! ‚òÅÔ∏è",
    "The snowiest place on Earth is believed to be Mount Baker in Washington, USA, which received 1,140 inches (29 meters) of snow in one year! ‚ùÑÔ∏è",
    "Wind speeds in a tornado can reach over 300 miles per hour (480 km/h) - faster than a Formula 1 race car! üå™Ô∏è",
    "The coldest temperature ever recorded was -128.6¬∞F (-89.2¬∞C) at Vostok Station, Antarctica in 1983! ü•∂",
    "A typical thunderstorm releases energy equivalent to a 20-kiloton nuclear weapon! ‚õàÔ∏è",
    "The sun evaporates over 1 trillion tons of water from Earth's surface every day! üåä",
    "Rainbows can appear at night - they're called 'moonbows' and are created by moonlight instead of sunlight! üåà"
];

function quickSearch(city) {
    document.getElementById('cityInput').value = city;
    getWeather();
}

async function getWeather() {
    const city = document.getElementById("cityInput").value.trim();
    if (!city) return showError("‚ö†Ô∏è Please enter a city name");

    hideAll();
    document.getElementById("loading").style.display = "block";

    try {
        const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`);
        const geoData = await geoRes.json();

        if (!geoData.results) throw new Error("City not found");

        const { latitude, longitude, name, country } = geoData.results[0];

        const weatherRes = await fetch(
            `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=temperature_2m,relativehumidity_2m,precipitation_probability,weathercode,cloudcover,visibility,uv_index,windspeed_10m&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_probability_max&timezone=auto`
        );
        const weatherData = await weatherRes.json();

        displayWeather(weatherData, name, country, latitude, longitude);
        displayExtraInfo(weatherData, latitude, longitude);

    } catch (err) {
        showError("‚ùå " + err.message);
    }
}

function displayWeather(data, city, country, lat, lon) {
    const w = data.current_weather;
    const current = new Date();
    const currentHour = current.getHours();

    document.getElementById("location").textContent = `${city}, ${country}`;
    document.getElementById("coords").textContent = `(${lat.toFixed(2)}¬∞, ${lon.toFixed(2)}¬∞)`;
    document.getElementById("temp").textContent = `${Math.round(w.temperature)}¬∞C`;
    document.getElementById("wind").textContent = Math.round(w.windspeed);
    document.getElementById("feels").textContent = Math.round(w.temperature - (w.windspeed * 0.3));
    document.getElementById("windDir").textContent = w.winddirection;
    document.getElementById("desc").textContent = weatherText(w.weathercode);
    document.getElementById("icon").textContent = weatherIcon(w.weathercode);
    document.getElementById("timestamp").textContent = `Last updated: ${current.toLocaleString()}`;

    const hourlyIndex = currentHour;
    document.getElementById("humidity").textContent = data.hourly.relativehumidity_2m[hourlyIndex] || 'N/A';
    document.getElementById("cloudCover").textContent = data.hourly.cloudcover[hourlyIndex] || 'N/A';
    document.getElementById("uvIndex").textContent = Math.round(data.hourly.uv_index[hourlyIndex] || 0);
    document.getElementById("visibility").textContent = Math.round((data.hourly.visibility[hourlyIndex] || 10000) / 1000);
    document.getElementById("pressure").textContent = Math.round(1013 + (Math.random() * 20 - 10));

    const tempHigh = data.daily.temperature_2m_max[0];
    const tempLow = data.daily.temperature_2m_min[0];
    document.getElementById("tempAnalysis").textContent = `${Math.round(w.temperature)}¬∞C`;
    document.getElementById("tempHigh").textContent = `${Math.round(tempHigh)}¬∞C`;
    document.getElementById("tempLow").textContent = `${Math.round(tempLow)}¬∞C`;
    const tempPercent = ((w.temperature - tempLow) / (tempHigh - tempLow)) * 100;
    document.getElementById("tempProgress").style.width = Math.max(0, Math.min(100, tempPercent)) + '%';

    const precipProb = data.hourly.precipitation_probability[hourlyIndex] || 0;
    document.getElementById("precipProb").textContent = precipProb + '%';
    document.getElementById("precipAmount").textContent = Math.round(precipProb / 10) + ' mm';
    document.getElementById("precipProgress").style.width = precipProb + '%';

    const sunrise = new Date(data.daily.sunrise[0]);
    const sunset = new Date(data.daily.sunset[0]);
    const daylightHours = (sunset - sunrise) / (1000 * 60 * 60);
    document.getElementById("sunrise").textContent = sunrise.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    document.getElementById("sunset").textContent = sunset.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    document.getElementById("daylight").textContent = `${Math.floor(daylightHours)}h ${Math.round((daylightHours % 1) * 60)}m`;

    let insights = '<ul style="list-style: none; padding: 0;">';
    insights += `<li>üå°Ô∏è Temperature is ${w.temperature > 25 ? 'warm' : w.temperature > 15 ? 'moderate' : 'cool'}</li>`;
    insights += `<li>üí® Wind conditions are ${w.windspeed > 30 ? 'strong' : w.windspeed > 15 ? 'moderate' : 'calm'}</li>`;
    insights += `<li>‚òÅÔ∏è Sky is ${data.hourly.cloudcover[hourlyIndex] > 70 ? 'mostly cloudy' : data.hourly.cloudcover[hourlyIndex] > 30 ? 'partly cloudy' : 'clear'}</li>`;
    insights += `<li>‚òÄÔ∏è UV index is ${data.hourly.uv_index[hourlyIndex] > 7 ? 'high' : data.hourly.uv_index[hourlyIndex] > 3 ? 'moderate' : 'low'}</li>`;
    insights += '</ul>';
    document.getElementById("insights").innerHTML = insights;

    const hourlyHTML = [];
    for (let i = 0; i < 24; i++) {
        const index = hourlyIndex + i;
        const hour = new Date(data.hourly.time[index]).getHours();
        const temp = Math.round(data.hourly.temperature_2m[index]);
        const code = data.hourly.weathercode[index];
        hourlyHTML.push(`
            <div class="hourly-card">
                <div class="hourly-time">${hour}:00</div>
                <div class="hourly-icon">${weatherIcon(code)}</div>
                <div class="hourly-temp">${temp}¬∞C</div>
                <div style="font-size: 0.8em; margin-top: 5px;">${data.hourly.precipitation_probability[index]}% üíß</div>
            </div>
        `);
    }
    document.getElementById("hourlyForecast").innerHTML = hourlyHTML.join('');

    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const dailyHTML = [];
    for (let i = 0; i < 7; i++) {
        const date = new Date(data.daily.time[i]);
        const dayName = i === 0 ? 'Today' : days[date.getDay()];
        const maxTemp = Math.round(data.daily.temperature_2m_max[i]);
        const minTemp = Math.round(data.daily.temperature_2m_min[i]);
        const code = data.daily.weathercode[i];
        dailyHTML.push(`
            <div class="daily-card">
                <div class="daily-day">${dayName}</div>
                <div class="daily-icon">${weatherIcon(code)}</div>
                <div style="font-size: 0.9em; margin: 5px 0;">${weatherText(code)}</div>
                <div class="daily-temps">
                    <span class="temp-high">${maxTemp}¬∞</span> / 
                    <span class="temp-low">${minTemp}¬∞</span>
                </div>
                <div style="font-size: 0.8em; margin-top: 5px;">${data.daily.precipitation_probability_max[i] || 0}% üíß</div>
            </div>
        `);
    }
    document.getElementById("dailyForecast").innerHTML = dailyHTML.join('');

    // Build the new SVG temperature chart
    buildTempSvgChart(data, hourlyIndex);

    document.getElementById("weather").style.display = "block";
    document.getElementById("loading").style.display = "none";
}

/* ============================================================
   SVG TEMPERATURE TREND CHART ‚Äî supports negative values
   ============================================================ */
function buildTempSvgChart(data, startIndex) {
    const svgEl = document.getElementById('tempSvgChart');
    const tooltip = document.getElementById('chartTooltip');

    // Pull 24 hourly temperatures starting from now
    const temps = [];
    const hours = [];
    for (let i = 0; i < 24; i++) {
        const idx = startIndex + i;
        temps.push(data.hourly.temperature_2m[idx]);
        hours.push(new Date(data.hourly.time[idx]).getHours());
    }

    // Layout constants (SVG viewBox is 0 0 900 220)
    const W = 900, H = 220;
    const padL = 52, padR = 20, padT = 28, padB = 44;
    const chartW = W - padL - padR;
    const chartH = H - padT - padB;

    const minT = Math.min(...temps);
    const maxT = Math.max(...temps);
    // Add a little breathing room so the line never touches the border
    const rangeBuffer = Math.max((maxT - minT) * 0.15, 1);
    const domainMin = minT - rangeBuffer;
    const domainMax = maxT + rangeBuffer;
    const domainRange = domainMax - domainMin;

    // Map value ‚Üí SVG y coordinate (y increases downward)
    const yScale = v => padT + chartH - ((v - domainMin) / domainRange) * chartH;
    // Map index ‚Üí SVG x coordinate
    const xScale = i => padL + (i / (temps.length - 1)) * chartW;

    /* ---- Helper: build smooth bezier path ---- */
    function smoothPath(pts) {
        if (pts.length < 2) return '';
        let d = `M ${pts[0][0]} ${pts[0][1]}`;
        for (let i = 0; i < pts.length - 1; i++) {
            const x0 = pts[i][0], y0 = pts[i][1];
            const x1 = pts[i + 1][0], y1 = pts[i + 1][1];
            const cx = (x0 + x1) / 2;
            d += ` C ${cx} ${y0} ${cx} ${y1} ${x1} ${y1}`;
        }
        return d;
    }

    const points = temps.map((t, i) => [xScale(i), yScale(t)]);
    const linePath = smoothPath(points);

    // Zero-line y position (only rendered if domain includes 0)
    const zeroY = yScale(0);
    const showZeroLine = domainMin < 0 && domainMax > 0;

    /* ---- Y-axis nice ticks ---- */
    function niceTicks(lo, hi, count = 5) {
        const step = (hi - lo) / (count - 1);
        const magnitude = Math.pow(10, Math.floor(Math.log10(Math.abs(step) || 1)));
        const niceStep = Math.ceil(step / magnitude) * magnitude;
        const start = Math.floor(lo / niceStep) * niceStep;
        const ticks = [];
        for (let v = start; v <= hi + niceStep * 0.1; v += niceStep) {
            if (v >= domainMin - 0.001 && v <= domainMax + 0.001) ticks.push(+v.toFixed(1));
        }
        return ticks;
    }
    const yTicks = niceTicks(domainMin, domainMax, 5);

    /* ---- Determine colour theme based on temperature range ---- */
    // Cold (any temp below 0) ‚Üí blue/cyan palette
    // Mixed                   ‚Üí purple gradient
    // Hot (all above 25)      ‚Üí orange/red palette
    let lineColor, gradTop, gradBot, dotFill;
    if (maxT < 0) {
        lineColor = '#4dabf7'; gradTop = 'rgba(77,171,247,0.35)'; gradBot = 'rgba(77,171,247,0.02)'; dotFill = '#339af0';
    } else if (minT < 0) {
        lineColor = '#a855f7'; gradTop = 'rgba(168,85,247,0.35)'; gradBot = 'rgba(168,85,247,0.02)'; dotFill = '#9333ea';
    } else if (minT > 25) {
        lineColor = '#ff6b35'; gradTop = 'rgba(255,107,53,0.35)'; gradBot = 'rgba(255,107,53,0.02)'; dotFill = '#e64e1b';
    } else {
        lineColor = '#667eea'; gradTop = 'rgba(102,126,234,0.38)'; gradBot = 'rgba(118,75,162,0.04)'; dotFill = '#764ba2';
    }

    /* ---- Build SVG markup ---- */
    // Gradient fill path: go to bottom-right corner, across to bottom-left, close
    const fillPath = linePath + ` L ${xScale(23)} ${padT + chartH} L ${padL} ${padT + chartH} Z`;

    let svg = `
    <defs>
        <linearGradient id="areaGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="${gradTop}"/>
            <stop offset="100%" stop-color="${gradBot}"/>
        </linearGradient>
        <filter id="glow">
            <feGaussianBlur stdDeviation="2.5" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
    </defs>

    <!-- Chart background -->
    <rect x="${padL}" y="${padT}" width="${chartW}" height="${chartH}"
          rx="6" fill="#f8f9ff" stroke="#e8eaf6" stroke-width="1"/>

    <!-- Y-axis grid lines & labels -->`;

    yTicks.forEach(v => {
        const y = yScale(v);
        const isZero = Math.abs(v) < 0.001;
        svg += `
    <line x1="${padL}" y1="${y}" x2="${padL + chartW}" y2="${y}"
          stroke="${isZero ? '#ef4444' : '#dde1f5'}"
          stroke-width="${isZero ? 1.5 : 1}"
          stroke-dasharray="${isZero ? '6,4' : '4,3'}"
          opacity="${isZero ? 0.8 : 0.7}"/>
    <text x="${padL - 8}" y="${y + 4}" text-anchor="end"
          font-size="11" fill="${isZero ? '#ef4444' : '#888'}"
          font-family="'Segoe UI', sans-serif" font-weight="${isZero ? '700' : '400'}">
        ${v >= 0 ? '' : ''}${Math.round(v)}¬∞
    </text>`;
    });

    // Zero label annotation if visible
    if (showZeroLine) {
        svg += `<text x="${padL + chartW + 4}" y="${zeroY + 4}" font-size="10" fill="#ef4444"
                      font-family="'Segoe UI', sans-serif" font-weight="700">0¬∞</text>`;
    }

    // X-axis hour labels ‚Äî show every 3 hours
    svg += `<!-- X-axis labels -->`;
    for (let i = 0; i < 24; i += 3) {
        const x = xScale(i);
        const h = hours[i];
        const label = h === 0 ? '12am' : h === 12 ? '12pm' : h < 12 ? `${h}am` : `${h - 12}pm`;
        svg += `
    <text x="${x}" y="${padT + chartH + 18}" text-anchor="middle"
          font-size="11" fill="#888" font-family="'Segoe UI', sans-serif">${label}</text>
    <line x1="${x}" y1="${padT + chartH}" x2="${x}" y2="${padT + chartH + 5}"
          stroke="#ccc" stroke-width="1"/>`;
    }

    // Gradient fill area
    svg += `<path d="${fillPath}" fill="url(#areaGrad)"/>`;

    // Main line
    svg += `<path d="${linePath}" fill="none" stroke="${lineColor}"
                  stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"
                  filter="url(#glow)" opacity="0.95"/>`;

    // Hover hit-area rects + dot markers
    svg += `<!-- Data points & hover areas -->`;
    temps.forEach((t, i) => {
        const x = xScale(i);
        const y = yScale(t);
        const h = hours[i];
        const label = h === 0 ? '12:00 AM' : h === 12 ? '12:00 PM' : h < 12 ? `${h}:00 AM` : `${h - 12}:00 PM`;
        const sign = t >= 0 ? '' : '‚àí';
        const absT = Math.abs(t).toFixed(1);

        // Only draw visible dot every 3 points to avoid clutter, but all get hover areas
        const dotR = (i % 3 === 0 || i === 0 || i === 23) ? 4.5 : 0;
        if (dotR > 0) {
            svg += `<circle cx="${x}" cy="${y}" r="${dotR}" fill="${dotFill}"
                            stroke="white" stroke-width="2" opacity="0.9"/>`;
        }

        // Transparent hover region
        svg += `
    <rect x="${x - chartW / (2 * 23)}" y="${padT}" width="${chartW / 23}" height="${chartH}"
          fill="transparent" class="chart-hover"
          data-temp="${sign}${absT}" data-hour="${label}"
          data-x="${x}" data-y="${y}"/>`;
    });

    svg += `<!-- Axis lines -->
    <line x1="${padL}" y1="${padT}" x2="${padL}" y2="${padT + chartH + 5}"
          stroke="#bbb" stroke-width="1.5"/>
    <line x1="${padL}" y1="${padT + chartH}" x2="${padL + chartW}" y2="${padT + chartH}"
          stroke="#bbb" stroke-width="1.5"/>`;

    svgEl.innerHTML = svg;

    /* ---- Tooltip interaction ---- */
    const wrapper = svgEl.parentElement;
    const hoverRects = svgEl.querySelectorAll('.chart-hover');

    // We need to map SVG coords ‚Üí pixel coords for the tooltip
    hoverRects.forEach(rect => {
        rect.addEventListener('mouseenter', (e) => {
            const svgRect = svgEl.getBoundingClientRect();
            const scaleX = svgRect.width / W;
            const scaleY = svgRect.height / H;

            const dataX = parseFloat(rect.getAttribute('data-x'));
            const dataY = parseFloat(rect.getAttribute('data-y'));

            // Pixel position inside wrapper
            const px = dataX * scaleX;
            const py = dataY * scaleY;

            const t = rect.getAttribute('data-temp');
            const hr = rect.getAttribute('data-hour');
            tooltip.textContent = `${t}¬∞C  ‚Ä¢  ${hr}`;
            tooltip.style.opacity = '1';

            // Centre the tooltip above the dot
            const tipW = tooltip.offsetWidth || 120;
            tooltip.style.left = (px - tipW / 2) + 'px';
            tooltip.style.top = (py - 44) + 'px';

            // Highlight dot
            const dotEls = svgEl.querySelectorAll('circle');
            dotEls.forEach(d => {
                const dcx = parseFloat(d.getAttribute('cx'));
                if (Math.abs(dcx - dataX) < 2) {
                    d.setAttribute('r', '6.5');
                    d.style.transition = 'r 0.15s';
                }
            });
        });

        rect.addEventListener('mouseleave', () => {
            tooltip.style.opacity = '0';
            svgEl.querySelectorAll('circle').forEach(d => d.setAttribute('r', '4.5'));
        });
    });
}

/* ============================================================
   END SVG CHART
   ============================================================ */

function displayExtraInfo(data, lat, lon) {
    const w = data.current_weather;
    const currentHour = new Date().getHours();
    const humidity = data.hourly.relativehumidity_2m[currentHour];

    const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 86400000);
    const place = indianPlaces[dayOfYear % indianPlaces.length];
    document.getElementById("placeIcon").textContent = place.icon;
    document.getElementById("placeName").textContent = place.name;
    document.getElementById("placeDesc").textContent = place.desc;
    document.getElementById("placeState").textContent = place.state;
    document.getElementById("placeCategory").textContent = place.category;
    document.getElementById("placeBestTime").textContent = `Best: ${place.bestTime}`;

    const aqi = Math.floor(Math.random() * 150) + 20;
    document.getElementById("aqiLevel").textContent = aqi;
    document.getElementById("aqiStatus").textContent = aqi < 50 ? 'Good' : aqi < 100 ? 'Moderate' : aqi < 150 ? 'Unhealthy for Sensitive' : 'Unhealthy';
    document.getElementById("pm25").textContent = Math.floor(aqi * 0.4);
    document.getElementById("aqiProgress").style.width = (aqi / 200 * 100) + '%';

    const moonPhases = [
        { name: "New Moon", icon: "üåë", illumination: "0%" },
        { name: "Waxing Crescent", icon: "üåí", illumination: "25%" },
        { name: "First Quarter", icon: "üåì", illumination: "50%" },
        { name: "Waxing Gibbous", icon: "üåî", illumination: "75%" },
        { name: "Full Moon", icon: "üåï", illumination: "100%" },
        { name: "Waning Gibbous", icon: "üåñ", illumination: "75%" },
        { name: "Last Quarter", icon: "üåó", illumination: "50%" },
        { name: "Waning Crescent", icon: "üåò", illumination: "25%" }
    ];
    const moonPhase = moonPhases[Math.floor(new Date().getDate() / 3.75)];
    document.getElementById("moonIcon").textContent = moonPhase.icon;
    document.getElementById("moonPhase").textContent = moonPhase.name;
    document.getElementById("moonIllumination").textContent = `${moonPhase.illumination} illuminated`;

    const sunrise = new Date(data.daily.sunrise[0]);
    const sunset = new Date(data.daily.sunset[0]);
    const solarNoon = new Date((sunrise.getTime() + sunset.getTime()) / 2);
    const goldenHourStart = new Date(sunset.getTime() - 60 * 60 * 1000);
    document.getElementById("solarNoon").textContent = solarNoon.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    document.getElementById("goldenHour").textContent = goldenHourStart.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    document.getElementById("starVisibility").textContent = data.hourly.cloudcover[currentHour] < 30 ? 'Excellent' : data.hourly.cloudcover[currentHour] < 70 ? 'Good' : 'Poor';

    const month = new Date().getMonth();
    const seasons = [
        { name: "Winter", activities: "üéø Skiing in Himalayas, üèñÔ∏è Beach visits, üö∂ City tours" },
        { name: "Spring", activities: "üå∏ Flower viewing, üèûÔ∏è Nature trails, üö¥ Cycling" },
        { name: "Summer", activities: "üèîÔ∏è Hill stations, üèä Swimming, üåä Water sports" },
        { name: "Autumn", activities: "üçÇ Trekking, üì∏ Photography, üé™ Festivals" }
    ];
    const season = seasons[Math.floor(month / 3)];
    document.getElementById("seasonalActivities").innerHTML = `<strong>${season.name}</strong><br>${season.activities}`;

    document.getElementById("weatherFact").textContent = weatherFacts[Math.floor(Math.random() * weatherFacts.length)];

    document.getElementById("dewPoint").textContent = Math.round(w.temperature - (100 - humidity) / 5);
    document.getElementById("precipitation").textContent = (Math.random() * 5).toFixed(1);
    document.getElementById("windGust").textContent = Math.round(w.windspeed * 1.5);
    document.getElementById("weatherMood").textContent = w.temperature > 20 && data.hourly.cloudcover[currentHour] < 50 ? 'üòä' : w.temperature < 10 ? 'ü•∂' : 'üòê';

    const outdoorScore = Math.max(0, Math.min(10, 10 - (Math.abs(w.temperature - 22) / 3) - (data.hourly.cloudcover[currentHour] / 20) - (w.windspeed / 10)));
    document.getElementById("outdoorIndex").textContent = outdoorScore.toFixed(1);

    document.getElementById("heatIndex").textContent = Math.round(w.temperature + (humidity - 40) * 0.1);
    document.getElementById("windChill").textContent = Math.round(w.temperature - (w.windspeed * 0.5));
    document.getElementById("rainbowChance").textContent = (data.hourly.precipitation_probability[currentHour] > 20 && data.hourly.cloudcover[currentHour] < 80) ? Math.floor(Math.random() * 40 + 20) : Math.floor(Math.random() * 20);

    const clothingHTML = [];
    if (w.temperature < 10) {
        clothingHTML.push(clothingItem("üß•", "Heavy Jacket", "heavy jacket"));
        clothingHTML.push(clothingItem("üß£", "Scarf", "scarf"));
        clothingHTML.push(clothingItem("üß§", "Gloves", "gloves"));
    } else if (w.temperature < 20) {
        clothingHTML.push(clothingItem("üß•", "Light Jacket", "light jacket"));
        clothingHTML.push(clothingItem("üëñ", "Long Pants", "men trousers"));
        clothingHTML.push(clothingItem("üëü", "Sneakers", "sneakers"));
    } else {
        clothingHTML.push(clothingItem("üëï", "T-Shirt", "t shirt"));
        clothingHTML.push(clothingItem("ü©≥", "Shorts", "men shorts"));
        clothingHTML.push(clothingItem("üï∂Ô∏è", "Sunglasses", "sunglasses"));
    }
    if (data.hourly.precipitation_probability[currentHour] > 30) {
        clothingHTML.push(clothingItem("‚òÇÔ∏è", "Umbrella", "umbrella"));
    }
    document.getElementById("clothingAdvice").innerHTML = clothingHTML.join("");

    const activityHTML = [];
    if (w.temperature > 15 && w.temperature < 30 && data.hourly.cloudcover[currentHour] < 50) {
        activityHTML.push('<div class="activity-card">üö¥ Cycling</div>');
        activityHTML.push('<div class="activity-card">üèÉ Running</div>');
        activityHTML.push('<div class="activity-card">üßò Yoga</div>');
    } else if (w.temperature > 25) {
        activityHTML.push('<div class="activity-card">üèä Swimming</div>');
        activityHTML.push('<div class="activity-card">üç¶ Ice Cream</div>');
        activityHTML.push('<div class="activity-card">üå≥ Park Visit</div>');
    } else {
        activityHTML.push('<div class="activity-card">üìö Reading</div>');
        activityHTML.push('<div class="activity-card">‚òï Caf√© Time</div>');
        activityHTML.push('<div class="activity-card">üé¨ Movie</div>');
    }
    if (data.hourly.precipitation_probability[currentHour] > 50) {
        activityHTML.push('<div class="activity-card">üè† Stay Indoor</div>');
    }
    document.getElementById("activitySuggestions").innerHTML = activityHTML.join('');

    const climateZones = {
        tropical: { range: "20-35¬∞C", type: "Tropical" },
        temperate: { range: "10-25¬∞C", type: "Temperate" },
        cold: { range: "-10-10¬∞C", type: "Cold" }
    };
    const zone = w.temperature > 25 ? climateZones.tropical : w.temperature > 10 ? climateZones.temperate : climateZones.cold;
    document.getElementById("climateZone").textContent = zone.type;
    document.getElementById("currentSeason").textContent = season.name;
    document.getElementById("typicalRange").textContent = zone.range;

    let alerts = '';
    if (w.temperature > 35) alerts += 'üå°Ô∏è Heat Advisory<br>';
    if (w.temperature < 0) alerts += '‚ùÑÔ∏è Freeze Warning<br>';
    if (w.windspeed > 40) alerts += 'üí® High Wind Alert<br>';
    if (data.hourly.precipitation_probability[currentHour] > 70) alerts += '‚òî Heavy Rain Expected<br>';
    if (data.hourly.uv_index[currentHour] > 8) alerts += '‚òÄÔ∏è High UV Alert<br>';
    document.getElementById("weatherAlerts").innerHTML = alerts || 'No active alerts';

    let photoTips = '';
    if (currentHour < 8 || currentHour > 18) photoTips += '‚ú® Golden hour lighting<br>';
    if (data.hourly.cloudcover[currentHour] < 30) photoTips += 'üåÖ Perfect for landscapes<br>';
    if (data.hourly.cloudcover[currentHour] > 70) photoTips += '‚òÅÔ∏è Dramatic cloud shots<br>';
    if (data.hourly.precipitation_probability[currentHour] > 30) photoTips += 'üåßÔ∏è Rain photography<br>';
    document.getElementById("photoTips").innerHTML = photoTips || 'Good conditions for general photography';

    const plantingScore = w.temperature > 15 && w.temperature < 30 && data.hourly.precipitation_probability[currentHour] < 50 ? 'Excellent' : 'Moderate';
    const wateringScore = humidity < 50 && w.temperature > 20 ? 'High Need' : 'Low Need';
    const gardeningActivity = w.temperature > 10 && w.temperature < 30 ? 'Plant & Prune' : 'Indoor Care';
    document.getElementById("plantingIndex").textContent = plantingScore;
    document.getElementById("wateringIndex").textContent = wateringScore;
    document.getElementById("gardeningActivity").textContent = gardeningActivity;
}

function weatherText(code) {
    if (code === 0) return "Clear sky";
    if (code <= 3) return "Partly cloudy";
    if (code <= 48) return "Foggy";
    if (code <= 67) return "Rainy";
    if (code <= 77) return "Snowy";
    if (code <= 82) return "Rain showers";
    if (code <= 86) return "Snow showers";
    return "Thunderstorm";
}

function weatherIcon(code) {
    if (code === 0) return "‚òÄÔ∏è";
    if (code <= 3) return "‚õÖ";
    if (code <= 48) return "üå´Ô∏è";
    if (code <= 67) return "üåßÔ∏è";
    if (code <= 77) return "‚ùÑÔ∏è";
    if (code <= 82) return "üå¶Ô∏è";
    if (code <= 86) return "üå®Ô∏è";
    return "‚õàÔ∏è";
}

function showError(msg) {
    const e = document.getElementById("error");
    e.textContent = msg;
    e.style.display = "block";
    document.getElementById("loading").style.display = "none";
}

function hideAll() {
    document.getElementById("error").style.display = "none";
    document.getElementById("weather").style.display = "none";
}

let autoUpdateInterval;
function startAutoUpdate() {
    if (autoUpdateInterval) clearInterval(autoUpdateInterval);
    autoUpdateInterval = setInterval(() => {
        const city = document.getElementById("cityInput").value.trim();
        if (city) getWeather();
    }, 600000);
}

document.addEventListener("click", function (e) {
    const item = e.target.closest(".clothing-item");
    if (item && item.dataset.link) {
        window.open(item.dataset.link, "_blank");
    }
});
</script>
</body>
</html>

